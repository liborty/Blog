<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Top Technical Tips</title>
    <description>Musings on open source software development
</description>
    <link>https://oldmill.cz/</link>
    <atom:link href="https://oldmill.cz/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Fri, 03 Jan 2020 00:06:52 +1000</pubDate>
    <lastBuildDate>Fri, 03 Jan 2020 00:06:52 +1000</lastBuildDate>
    <generator>Jekyll v3.1.6</generator>
    
      <item>
        <title>The Joy of Bashing</title>
        <description>&lt;h2 id=&quot;retro-programming&quot;&gt;(Retro Programming)&lt;/h2&gt;

&lt;p&gt;Within my new open-source project &lt;a href=&quot;https://github.com/liborty/TokenCrypt&quot;&gt;TokenCrypt&lt;/a&gt;
I went for good,
simple, old-fashioned Bash scripting and in the process I have become a fan of ‘retro programming’.&lt;/p&gt;

&lt;p&gt;‘What? No Python?’ I see you throwing your arms up in horror.
It has to be said that Bash still holds some advantages:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Bash needs no installations and library searching.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The REPL loop for trying things out is right there in any terminal.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Bash is tightly integrated with the operating system, right out of the box.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;‘Everything is just a string’.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;It is sheer fun to learn old lore and magical incantations.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;In fairness, there is also one problem: no floating point arithmetic.
Suppose we want to do a simple floating point division C=A/B.&lt;/p&gt;

&lt;p&gt;We can reach for &lt;code class=&quot;highlighter-rouge&quot;&gt;AWK&lt;/code&gt; but the code is a bit messy.
It is uncharacteristically long-winded for Bash. Plus we have to start a new
sub-process for &lt;code class=&quot;highlighter-rouge&quot;&gt;awk&lt;/code&gt;, even for simple calculations such as this one:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt; awk &lt;span class=&quot;s2&quot;&gt;&quot;BEGIN { print &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$A&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; / &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$B&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; }&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Luckily, in most situations, there is a better alternative: &lt;strong&gt;fixed point arithmetic&lt;/strong&gt;.
Suppose we want to calculate the ratio of the byte sizes of two directories,
for example to report their compression ratio.&lt;/p&gt;

&lt;p&gt;It will be a number between zero and one.
In general, it is easy to check that we are always dividing by the bigger of the two numbers.
Ratios are better to calculate with than percentages and any barely numerate person
ought to be able to mentally translate them to percentages by myltiplying them by 100.&lt;/p&gt;

&lt;p&gt;The following line fills an array called SIZES with the sizes and names of the
two directories:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;SIZES&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=(&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt; du &lt;span class=&quot;nt&quot;&gt;-hbs&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$OUTDIR&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$INDIR&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# array of size1, dir1, size2, dir2&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Next we use the magic of printf formatting &lt;code class=&quot;highlighter-rouge&quot;&gt;&quot;0.%05d&quot;&lt;/code&gt; to turn an ordinary integer into a ‘float’:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nb&quot;&gt;printf&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Output size:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;%s (%s)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Original size:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;%s (%s)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;
Compression:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;0.%05d&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;SIZES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[0]&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;SIZES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[1]&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;SIZES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[2]&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;SIZES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[3]&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;$((&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;100000&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;SIZES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[0]&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;SIZES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[2]&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The last line is the actual fixed point (integer) calculation. We have chosen to calculate the
ratio to five decimal places, so we premultiply by 100000. The five zeroes correspond
to the five ‘decimal’ places in the formatting string above. It is just a temporary 
left shift by five decimal places, followed by a right shift back, simulated by
prepending the literal string ‘0.’ before the integer result. And there you have it, Dr Watson.&lt;/p&gt;

&lt;p&gt;Check out the &lt;a href=&quot;https://github.com/liborty/TokenCrypt&quot;&gt;TokenCrypt&lt;/a&gt;&lt;/p&gt;

</description>
        <pubDate>Thu, 02 Jan 2020 00:00:00 +1000</pubDate>
        <link>https://oldmill.cz/bash/script/retro/programming/2020/01/02/the-joy-of-bashing.html</link>
        <guid isPermaLink="true">https://oldmill.cz/bash/script/retro/programming/2020/01/02/the-joy-of-bashing.html</guid>
        
        
        <category>bash</category>
        
        <category>script</category>
        
        <category>retro</category>
        
        <category>programming</category>
        
      </item>
    
  </channel>
</rss>
